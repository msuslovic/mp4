---
title: "MP4"
author: "Meghan Suslovic & Yifan Ma"
date: "5/3/2018"
output: html_document:
    code_folding: hide
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Female directors, writers, and producers
Source: IMDB
name table: has gender
info_type: runtime, genres
kind_type: movie=1
role_type: director=8, producer=3, 

join role_type with cast_info based on 

SELECT ci. person_id, ci. movie_id, ci. role_id
FROM cast_info ci
JOIN role_type rt
ON ci. role_id = rt .id
WHERE rt.id = 8
;


Context:
http://www.denofgeek.com/us/movies/female-directors/252810/26-female-directors-you-should-know-about-and-why-you-might-not 


-find percentage of female directors of feature length movies 
-is there a genre of movie that women direct in higher percentages
-how do the ratings differ
-are there more females working in a particular country (in info table)?
<<<<<<< HEAD
-how does their budget compare to movies with male directors?
-are females directing in higher ratios in independent films vs studio ones?


```{r}
library(mdsr)
library(tidyverse)
library(RMySQL)
db <- dbConnect_scidb(dbname = "imdb")
```

```{r}
base <- db %>%
  dbGetQuery("SELECT n. gender, t. Production_year
FROM cast_info ci
JOIN role_type rt
ON ci. role_id = rt .id
JOIN name n
ON n.id =  ci. person_id
JOIN movie_info mi ON mi. movie_id = ci. movie_id
JOIN info_type it ON mi. Info_type_id = it.id
JOIN title t ON t.id  = ci. movie_id
JOIN kind_type kt ON kt. id = t. kind_id 
WHERE gender = 'f'AND rt.id = 8 AND t. kind_id = 1 AND (info_type_id = 1 OR info_type_id = 3)
GROUP BY production_year
")

head(base)
```


```{r}
genre <- db %>%
  dbGetQuery("SELECT n. gender, t. Production_year, mi.info
FROM cast_info ci
JOIN role_type rt
ON ci. role_id = rt .id
JOIN name n
ON n.id =  ci. person_id
JOIN movie_info mi ON mi. movie_id = ci. movie_id
JOIN info_type it ON mi. Info_type_id = it.id
JOIN title t ON t.id  = ci. movie_id
JOIN kind_type kt ON kt. id = t. kind_id 
WHERE  rt.id = 8 AND t. kind_id = 1 AND info_type_id = 3
")

```

```{r}
genre <- genre %>%
  select(gender, info) %>%
  filter (!is.na(gender), !is.na(info))

g_sum <- genre %>%
  group_by(info) %>%
  summarise(S = n())

genre_w <-genre %>%
  group_by(info) %>%
  summarise(p = sum(gender == "f")) %>%
  left_join(g_sum, by = "info") %>%
  mutate (p_w = p/S*100) %>%
  arrange (desc(p_w))

top_5 <- genre_w %>%
  arrange (desc(p)) %>%
  head(5) %>%
  ggplot(aes (x = info, y = p))+
  geom_bar(stat = "identity")

top_5

ptop_5 <- genre_w %>%
  arrange (desc(p_w)) %>%
  head(5) %>%
  ggplot(aes (x = info, y = p_w))+
  geom_bar(stat = "identity")

ptop_5
```

